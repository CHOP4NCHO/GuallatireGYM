<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
      .btn-r{
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  max-width: 315px;
  padding: 12px 18px;
  border-radius: 18px;
  border: 0;
  font-family: Gotham-Medium,sans-serif;
  font-size: 17px;
  line-height: 21px;
  text-align: center;
  text-decoration: none;
  cursor: pointer;
}
  </style>
  {% load static %}
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static './css/home.css'%}">
    <title>Miembros</title>
</head>
<body style="height: 1000px">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a style="margin-left:10px;"class="navbar-brand" href="/home/">Gimnasio Guallatire</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
          </ul>
        </div>
        <a  style="background-color: blue;"class = "btn-r" href="/manageusers/crearUsuario">Crear usuario</a>  
        <a  style="background-color: blue;"class = "btn-r" href="../logout">Cerrar Sesión</a>
      </nav>
    <div class="container-fluid" style="margin-top:20px;">
<link rel="stylesheet" href="../static/css/gestionMiembro.css">
<div class="d-inline-block">
    <h1 style="color:white;">Miembros</h1>
</div>
{% if user.usuarios.rol != "Administrador" %}
<h2>NO SE PUEDE ENTRAR NO ERES ADMIN</h2>
<meta http-equiv = "refresh" content = "2; url = ../home/" />

{% else %}
{%if tipo == "warning" %}
<div class="alert alert-warning alert-dismissible fade show" role="alert">
  <strong>{{Message}}</strong>
  <button type="button" class="btn btn-close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
{%endif%}

  <div class="mb-3">
    <form action="/filtrarPorColumna/" method="POST" id="filterForm"> {%csrf_token%}
    
    <h2 style="color:white;"for="basic-url" class="form-label">Buscar</h2>
    <div class="input-group">
      {%if filtro %}
      <input type="text" name="filtro"class="form-control"value="{{filtro}}">
      {%else%}
      <input type="text" name="filtro"class="form-control">
      {%endif%}
      {%if columna == "sin_filtro"%}
      <select value ="{{columna}}" name="columna" id ="idSelected"class="btn btn-light dropdown-toggle filtro" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        <option selected value="sin_filtro">Sin filtro</option>
        <option value="nombre">Nombre</option>
        <option value="apellido">Apellido</option>
        <option value="rut">Rut</option>
        <option value="rol">Rol</option>
      {%elif columna == "nombre"%}
      <select value ="{{columna}}" name="columna" id ="idSelected"class="btn btn-light dropdown-toggle filtro" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        <option value="sin_filtro">Sin filtro</option>
        <option selected value="nombre">Nombre</option>
        <option value="apellido">Apellido</option>
        <option value="rut">Rut</option>
        <option value="rol">Rol</option>
      {%elif columna == "apellido"%}
      <select value ="{{columna}}" name="columna" id ="idSelected"class="btn btn-light dropdown-toggle filtro" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        <option value="sin_filtro">Sin filtro</option>
        <option value="nombre">Nombre</option>
        <option selected value="apellido">Apellido</option>
        <option value="rut">Rut</option>
        <option value="rol">Rol</option>
      {%elif columna == "rut"%}
      <select value ="{{columna}}" name="columna" id ="idSelected"class="btn btn-light dropdown-toggle filtro" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        <option value="sin_filtro">Sin filtro</option>
        <option value="nombre">Nombre</option>
        <option value="apellido">Apellido</option>
        <option selected value="rut">Rut</option>
        <option value="rol">Rol</option>
      {%elif columna == "rol"%}
      <select value ="{{columna}}" name="columna" id ="idSelected"class="btn btn-light dropdown-toggle filtro" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        <option value="sin_filtro">Sin filtro</option>
        <option value="nombre">Nombre</option>
        <option value="apellido">Apellido</option>
        <option value="rut">Rut</option>
        <option selected value="rol">Rol</option>
      {%else%}
      <select  name="columna" id ="idSelected"class="btn btn-light dropdown-toggle filtro" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        <option value="sin_filtro">Sin filtro</option>
        <option value="nombre">Nombre</option>
        <option value="apellido">Apellido</option>
        <option value="rut">Rut</option>
        <option value="rol">Rol</option>

      {%endif%}
      </select>
      <button class="btn btn-light filtro">Filtrar</button>
    </div>
    </form>
  </div>
</div>
<br>
<div class="d-xxl-flex justify-content-center" style="margin-bottom: 200px;">
    <div class = "col-xl-12 col-xl-6 col-xl-8 col-xl-8">
        <div class ="table-responsive">
            <table class="table table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>Id</th>
                        <th>Rut</th>
                        <th>Nombre</th>
                        <th>Apellido</th>
                        <th>Correo</th>
                        <th>Rol</th>
                        <th>Entrenador</th>
                        <th>Tarjeta</th>
                        <th>Estado</th>
                        <th colspan="2">Opciones</th>
                    </tr>
                </thead>
                <tbody>
                    
                  
                    {% for u in Users %}
                    {%if u.usuarios.rol != "Administrador"%}
                    {%if u.is_active %}
                    <tr class="table-success">
                    {%else%}
                    <tr class="table-danger">
                    {%endif%}
                        <td>{{u.id}}</td>
                        <td>{{u.usuarios.rut}}</td>
                        <td>{{u.usuarios.nombre}}</td>
                        <td>{{u.usuarios.apellido}}</td>
                        <td>{{u.email}}</td>
                        <td>{{u.usuarios.rol}}</td>
                        <td>{{u.usuarios.entrenador}}</td>
                        <td><button id="{{u.id}}"type="button" onclick="editarInfo('{{u.usuarios}}')" class="btn btn-warning" data-toggle="modal" data-target="#exampleModal">Modificar</button></td>                        
                        {%if u.is_active %}
                        <td>Activo</td>
                        {%else%}
                        <td>Inactivo</td>
                        {%endif%}
                        <td><a href="/edicionUsuario/{{u.id}}" class="btn btn-info">Editar</a></td>
                        <td><a href="/eliminarUsuario/{{u.id}}" class="btn btn-danger btnEliminacion">Eliminar</a></td>
                    </tr>
                </tbody>
        </div>
    </div>
</div>
{% endif %}
{%endfor%}
<div style="color:black;"class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" style="color: black;" id="exampleModalLabel">Informacion de tarjeta</h5>
        <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        {%csrf_token%}
        <form action="/modificarTarjeta/" method="POST"> {%csrf_token%}
          <div class="mb-3" style="display:none;">
            <input type="text" id ="idTarjeta"name="idTarjeta" value="" readonly class="form-control" required>
        </div>
          <div class="form-group owner">
            <label for="owner">Titular de la tarjeta </label>
            <input name = "nombreTitular"id ="nombreTitular"type="text"class="form-control" required>
        </div>
        <div class="form-group CVV">
            <label for="cvv">CVV</label>
            <input type="text" class="form-control" id="cvv" placeholder="123" name="cvv" required>
        </div>
        <div class="form-group">
            <label>Numero de tarjeta</label>
            <input type="text" id ="tarjeta"class="form-control" name="tarjeta" placeholder="0000-1111-2222-3333" required>
        </div>
        <div class="form-group" id="expiration-date"><br>
            <label>Fecha de expiracion</label>
            <select name ="mes" id="mes">
                <option value="01">01</option>
                <option value="02">02</option>
                <option value="03">03</option>
                <option value="04">04</option>
                <option value="05">05</option>
                <option value="06">06</option>
                <option value="07">07</option>
                <option value="08">08</option>
                <option value="09">09</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
            </select>
            <select name="año" id="año">
                <option value="20">2020</option>
                <option value="21">2021</option>
                <option value="20">2022</option>
                <option value="21">2023</option>
                <option value="20">2024</option>
                <option value="21">2025</option>
            </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
        <button type="submit" class="btn btn-primary">Guardar cambios</button>
      </div>
      </form>
    </div>
  </div>
</div>


<script>
  //Esta funcion obtiene la informacion ya registrada de algun usuario y la muestra al editar
  function editarInfo(variable){
    var datos = variable.split(",");
    console.log(datos)
    var inputId = document.getElementById('idTarjeta');
    var nombreId = document.getElementById('nombreTitular');
    var tarjeta = document.getElementById('tarjeta');
    var cvv = document.getElementById('cvv');
    var mes = document.getElementById('mes');
    var año = document.getElementById('año')
    inputId.value = datos[0];
    nombreId.value = datos[7];
    tarjeta.value = datos[3];
    mes.value = datos[4];
    año.value = datos[5];
    cvv.value = datos[6];
  }
  function mostrarEntrenador(opcion){
    valor = document.getElementById('rol').value;
    if (valor != "Cliente"){
      document.getElementById('entrenador').style = "display:none";
      document.getElementById('labelEntrenador').style = "display:none";
      document.getElementById('entrenador').value = "";
      }
    else{
      document.getElementById('entrenador').style = "display:block";
      document.getElementById('labelEntrenador').style = "display:block";
    }
  }
 </script>
 <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
 <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
 <script src="{% static 'js/gestionUsuario.js' %}"></script>
{% endif %}
 

